-- LayerTool for InDesign CS5-- version 2-- created by medul6, Michael Heck, 2012-- open sourced on August 10th, 2012 on Github > check the LICENSE.txt and README.md in the repository for detailed information-- https://github.com/medul6/indesign-layer-tool-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••-- global variablesglobal activeDocumentglobal openDocumentsglobal otherDocumentsglobal deduplicatedLayerNamesglobal layerNameListActiveDocglobal dieAntwort-- test globalsglobal duplicateLoopVariableglobal chosenLayerRepeat-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••tell application "Adobe InDesign CS5"		-- set up some informations from the current state as variables	set activeDocument to active document	set openDocuments to every document	set otherDocuments to every document whose id is not activeDocument's id	set layerListActiveDoc to every layer of activeDocument		-- initialize some lists (to be filled in the next two repeat loops)	set layerList to {}	set layerNameList to {}	set layerNameListActiveDoc to {}		-- fills the layerList with every layer from every document (but there might be duplicates in it)	repeat with i from 1 to count openDocuments		set layerList to layerList & every layer of item i of openDocuments	end repeat		-- creates a new list but with readable names instead of IDs (to present them later to the user)	repeat with i from 1 to count layerList		set layerNameList to layerNameList & name of item i of layerList	end repeat	repeat with i from 1 to count layerListActiveDoc		set layerNameListActiveDoc to layerNameListActiveDoc & name of item i of layerListActiveDoc	end repeat		-- the deduplicting function removes the duplicates from the readable names list	deduplicator(reverse of layerNameList) of me		-- this will display a dialog in which the user can select the desired function of this tool	functionChooser() of me	end tell-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••-- the duplicator take a list as an argument and returns a new deduplicated listto deduplicator(l)	set deduplicatedLayerNames to {}	repeat with i from 1 to count l		set x to (l's item i)		if x is not in deduplicatedLayerNames then set end of deduplicatedLayerNames to x	end repeat	deduplicatedLayerNamesend deduplicator-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••-- the functionChooser shows the user a list dialog with the functions of the script. after choosing the desired function gets called (together with one or more arguments)on functionChooser()	set functionChoice to choose from list {"Einblenden", "Ausblenden", "Löschen", "Umbenennen", "Kopieren", "Zusammenführen", "Sperren", "Entsperren"} with prompt "Funktion wählen:" OK button name "Weiter!"		if the functionChoice = {"Einblenden"} then		set functionChoiceBool to true		layerVisibler(functionChoice, functionChoiceBool) of me	else if the functionChoice = {"Ausblenden"} then		set functionChoiceBool to false		layerVisibler(functionChoice, functionChoiceBool) of me	else if the functionChoice = {"Löschen"} then		layerDeleter(functionChoice) of me	else if the functionChoice = {"Umbenennen"} then		layerNamer(functionChoice) of me	else if the functionChoice = {"Kopieren"} then		copyLayersToOtherDocumentsNew(functionChoice) of me	else if the functionChoice = {"Zusammenführen"} then		mergeLayers(functionChoice) of me	else if the functionChoice = {"Sperren"} then		set functionChoiceBool to true		layerLocker(functionChoice, functionChoiceBool) of me	else if the functionChoice = {"Entsperren"} then		set functionChoiceBool to false		layerLocker(functionChoice, functionChoiceBool) of me	end if	end functionChooser-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on layerVisibler(functionChoice, functionChoiceBool)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed		if the result is not false then		repeat with i from 1 to count chosenLayer			set chosenLayerRepeat to item i of the chosenLayer			repeat with i from 1 to count openDocuments				try					tell application "Adobe InDesign CS5"						set visible of layer chosenLayerRepeat of item i of openDocuments to functionChoiceBool					end tell				end try			end repeat		end repeat	end if	displayTheEnd() of meend layerVisibler-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on layerDeleter(functionChoice)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed		if the result is not false then		repeat with i from 1 to count chosenLayer			set chosenLayerRepeat to item i of the chosenLayer			repeat with i from 1 to count openDocuments				try					tell application "Adobe InDesign CS5"						delete layer chosenLayerRepeat of item i of openDocuments					end tell				end try			end repeat		end repeat	end if	displayTheEnd() of meend layerDeleter-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on layerNamer(functionChoice)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed		if the result is not false then				textInput() of me				if dieAntwort = "" then			return		end if				repeat with i from 1 to count chosenLayer			set chosenLayerRepeat to item i of the chosenLayer			repeat with i from 1 to count openDocuments				try					tell application "Adobe InDesign CS5"						set name of layer chosenLayerRepeat of item i of openDocuments to dieAntwort					end tell				end try			end repeat		end repeat	end if	displayTheEnd() of meend layerNamer-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on textInput()	display dialog "Wie sollen die Ebenen umbenannt werden?" default answer ""	set dieAntwort to (text returned of result)	return dieAntwortend textInput-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on copyLayersToOtherDocumentsNew(functionChoice)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list layerNameListActiveDoc with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed		tell application "Adobe InDesign CS5"		set pageCount to count pages of activeDocument -- maybe it would be better to check if all the documents have the same page count		set activeLayer to active layer of active document		if the result is not false then			repeat with z from 1 to count chosenLayer -- this iterates through the layers that are chosen (one or more)				set chosenLayerRepeat to item z of the chosenLayer				set currentLayerColor to layer color of layer chosenLayerRepeat of activeDocument				repeat with y from 1 to count otherDocuments -- this iterates through the open documents										set duplicateLoopVariable to (every item of all page items of activeDocument whose (name of its item layer is chosenLayerRepeat) and (parent's class is not group))					duplicate (reverse of duplicateLoopVariable) to layer chosenLayerRepeat of otherDocuments's item y									end repeat				set the layer color of layer chosenLayerRepeat of otherDocuments's item y to currentLayerColor			end repeat		end if	end tell	displayTheEnd() of meend copyLayersToOtherDocumentsNew-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on mergeLayers(functionChoice)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Ebene(n) zum Zusammenführen wählen:" OK button name buttonName with multiple selections allowed	set mergeLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Zielebene wählen:" OK button name buttonName		tell application "Adobe InDesign CS5"		if the result is not false then			repeat with x from 1 to count chosenLayer				set chosenLayerRepeat to item x of the chosenLayer				repeat with y from 1 to count openDocuments					try						merge layer (mergeLayer as text) of openDocuments's item y with layer (chosenLayerRepeat as text) of openDocuments's item y					end try				end repeat			end repeat		end if	end tell	displayTheEnd() of meend mergeLayers-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on layerLocker(functionChoice, functionChoiceBool)	set buttonName to functionChoice & "!" as text	set chosenLayer to choose from list (reverse of deduplicatedLayerNames) with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed		if the result is not false then		repeat with i from 1 to count chosenLayer			set chosenLayerRepeat to item i of the chosenLayer			repeat with i from 1 to count openDocuments				try					tell application "Adobe InDesign CS5"						set locked of layer chosenLayerRepeat of item i of openDocuments to functionChoiceBool					end tell				end try			end repeat		end repeat	end if	displayTheEnd() of meend layerLocker-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••on displayTheEnd()	display dialog "Fertig!" buttons "OK" default button "OK"end displayTheEnd-- Here starts the garbage, the left-overs, whatever you gonna call it ...-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••--on copyLayersToOtherDocumentsOld(functionChoice)--	set buttonName to functionChoice & "!" as text--	set chosenLayer to choose from list layerNameListActiveDoc with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed--	--	tell application "Adobe InDesign CS5"--		set pageCount to count pages of activeDocument--		set activeLayer to active layer of active document--		if the result is not false then--			repeat with z from 1 to count chosenLayer--				set chosenLayerRepeat to item z of the chosenLayer--				set currentLayerColor to layer color of layer chosenLayerRepeat of activeDocument--				repeat with y from 1 to count otherDocuments--					repeat with i from 1 to pageCount--						set myCurrentPageItems to (page i's page items of activeDocument whose item layer's name is chosenLayerRepeat)--						--						--repeat with x from 1 to count myCurrentPageItems--						repeat with x from (count myCurrentPageItems) to 1 by -1 --this one is better because before it duplicated the items in reverse ...--							set myDuplicate to duplicate myCurrentPageItems's item x to page i of otherDocuments's item y--						end repeat--						--					end repeat--					set the layer color of layer chosenLayerRepeat of otherDocuments's item y to currentLayerColor--				end repeat--			end repeat--		end if--	end tell--	displayTheEnd() of me--end copyLayersToOtherDocumentsOld--on copyLayersToOtherDocumentsNew(functionChoice)--	set buttonName to functionChoice & "!" as text--	set chosenLayer to choose from list layerNameListActiveDoc with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed--	--	tell application "Adobe InDesign CS5"--		set pageCount to count pages of activeDocument -- maybe it would be better to check if all the documents have the same page count--		set activeLayer to active layer of active document--		if the result is not false then--			repeat with z from 1 to count chosenLayer -- this iterates through the layers that are chosen (one or more)--				set chosenLayerRepeat to item z of the chosenLayer--				set currentLayerColor to layer color of layer chosenLayerRepeat of activeDocument--				repeat with y from 1 to count otherDocuments -- this iterates through the open documents--					repeat with i from 1 to pageCount -- this iterates through the pages from beginning to end--						--set myCurrentPageItems to (page i's page items of activeDocument whose item layer's name is chosenLayerRepeat)--						----						----repeat with x from 1 to count myCurrentPageItems--						--repeat with x from (count myCurrentPageItems) to 1 by -1 --this one is better because before it duplicated the items in reverse ...--						--	set myDuplicate to duplicate myCurrentPageItems's item x to page i of otherDocuments's item y--						--end repeat--						--						--duplicate (every page item of activeDocument where name of its item layer is chosenLayerRepeat) to page i of otherDocuments's item y --works!!!--						--duplicate (every item of all page items of activeDocument where name of its item layer is chosenLayerRepeat) to page i of otherDocuments's item y --works but no groups and reverse order--						set duplicateLoopVariable to (every item of all page items of activeDocument where name of its item layer is chosenLayerRepeat)--						duplicate (reverse of duplicateLoopVariable) to page i of otherDocuments's item y--						--set duplicateLoopVariable to (every page item of activeDocument where name of its item layer is chosenLayerRepeat)--						--duplicate (reverse of duplicateLoopVariable) to page i of otherDocuments's item y--						--					end repeat--					set the layer color of layer chosenLayerRepeat of otherDocuments's item y to currentLayerColor--				end repeat--			end repeat--		end if--	end tell--	displayTheEnd() of me--end copyLayersToOtherDocumentsNew--on copyLayersToOtherDocumentsTest(functionChoice)--	set buttonName to functionChoice & "!" as text--	set chosenLayer to choose from list layerNameListActiveDoc with prompt "Ebene wählen:" OK button name buttonName with multiple selections allowed--	--	tell application "Adobe InDesign CS5"--		set pageCount to count pages of activeDocument -- maybe it would be better to check if all the documents have the same page count--		set activeLayer to active layer of active document--		if the result is not false then--			repeat with z from 1 to count chosenLayer -- this iterates through the layers that are chosen (one or more)--				set chosenLayerRepeat to item z of the chosenLayer--				set currentLayerColor to layer color of layer chosenLayerRepeat of activeDocument--				repeat with y from 1 to count otherDocuments -- this iterates through the open documents--					--!repeat with i from 1 to pageCount -- this iterates through the pages from beginning to end--					--set myCurrentPageItems to (page i's page items of activeDocument whose item layer's name is chosenLayerRepeat)--					----					----repeat with x from 1 to count myCurrentPageItems--					--repeat with x from (count myCurrentPageItems) to 1 by -1 --this one is better because before it duplicated the items in reverse ...--					--	set myDuplicate to duplicate myCurrentPageItems's item x to page i of otherDocuments's item y--					--end repeat--					--					--duplicate (every page item of activeDocument where name of its item layer is chosenLayerRepeat) to page i of otherDocuments's item y --works!!!--					--duplicate (every page item of activeDocument where name of its item layer is chosenLayerRepeat) to layer chosenLayerRepeat of otherDocuments's item y --works here but wrong--					--duplicate (every item of all page items of activeDocument where name of its item layer is chosenLayerRepeat) to page i of otherDocuments's item y --works but no groups and reverse order--					--set duplicateLoopVariable to (every item of all page items of activeDocument where name of its item layer is chosenLayerRepeat)--					--duplicate (reverse of duplicateLoopVariable) to page i of otherDocuments's item y--					set duplicateLoopVariable to (every page item of activeDocument where name of its item layer is chosenLayerRepeat)--					duplicate (reverse of duplicateLoopVariable) to layer chosenLayerRepeat of otherDocuments's item y--					--				end repeat--				set the layer color of layer chosenLayerRepeat of otherDocuments's item y to currentLayerColor--				--!end repeat--			end repeat--		end if--	end tell--	displayTheEnd() of me--end copyLayersToOtherDocumentsTest